{% import "components/topbar.html" as TopBar %}
{% extends "base.html" %}

{% block content %}
    <div class="bg-neutral-800 min-h-screen">
        {{ TopBar.render(title='Fronius', user=user) }}

        {% set items = [
            {
                'name': 'Potência Máxima',
                'value': '999 kw/h'
            },

            {
                'name': 'Capacidade Máxima de Potência',
                'value': '999 Kw/h'
            },

            {
                'name': 'Limite de Potência',
                'value': '999 Kw/h'
            },
            {
                'name': 'Potência L1',
                'value': ' 999 W'
            },
            {
                'name': 'Potência L2',
                'value': ' 999 W'
            },
            {
                'name': 'Potência L3',
                'value': ' 999 W'
            }

            ] %}

        {% set items2 = [
            {
                'name': 'Tensão L1',
                'value': ' 999 V'
            },

            {
                'name': 'Tensão L2',
                'value': ' 999 V'
            },
            {
                'name': 'Tensão L3',
                'value': ' 999 V'
            },

            {
                'name': 'Corrente L1',
                'value': ' 999 A'
            },

            {
                'name': 'Corrente L2',
                'value': ' 999 A'
            },

            {
                'name': 'Corrente L3',
                'value': ' 999 A'
            }
            ] %}

        <div class="flex flex-col w-full px-3 text-2xl gap-3">
            <div class="flex gap-3">
                <div class="flex flex-col border-2 rounded-2xl py-2 flex-grow ">
                    {% for item in items %}
                        <div class="flex justify-between {% if not loop.last %} border-b-2 border-neutral-700 {% endif %} mx-3 px-2 py-1">
                            <span>
                                {{ item.name }}
                            </span>
                            <span class="font-semibold">
                                {{ item.value }}
                            </span>
                        </div>
                    {% endfor %}
                </div>

                <div class="flex flex-col border-2 rounded-2xl flex-grow py-2">
                    {% for item in items2 %}
                        <div class="flex justify-between {% if not loop.last %} border-b-2 border-neutral-700 {% endif %} mx-3 px-2 py-1">
                            <span>
                                {{ item.name }}
                            </span>
                            <span class="font-semibold">
                                {{ item.value }}
                            </span>
                        </div>
                    {% endfor %}
                </div>

            </div>
            <div class="flex gap-3 ">
                <div class="flex flex-col flex-grow border-2 rounded-2xl p-3 gap-2">
                    <h2>Tensão L1</h2>
                    <canvas class="bg-red-500 max-h-[200px]"> 
                    </canvas>
                </div>
                <div class="flex flex-col flex-grow border-2 rounded-2xl p-3 gap-2">
                    <h2>Tensão L2</h2>
                    <canvas class="bg-red-500 max-h-[200px]"> 
                    </canvas>
                </div>
                <div class="flex flex-col flex-grow border-2 rounded-2xl p-3 gap-2">
                    <h2>Tensão L3</h2>
                    <canvas class="bg-red-500 max-h-[200px]"> 
                    </canvas>
                </div>
                
            </div>
            <div class="flex gap-3 ">
                <div class="flex flex-col flex-grow border-2 rounded-2xl p-3 gap-2">
                    <h2>Corrente L1</h2>
                    <canvas id="chartTensao" class="w-[678px] h-[339px]"></canvas> 
                    </canvas>
                </div>
                <div class="flex flex-col flex-grow border-2 rounded-2xl p-3 gap-2">
                    <h2>Corrente L2</h2>
                    <canvas class="bg-red-500 max-h-[200px]"> 
                    </canvas>
                </div>
                <div class="flex flex-col flex-grow border-2 rounded-2xl p-3 gap-2">
                    <h2>Corrente L3</h2>
                    <canvas class="bg-red-500 max-h-[200px]"> 
                    </canvas>
                </div>
                
            </div>

        </div>


<!-- 
        <div id="container-geral" class="flex w-[1626px] h-[928px] flex-col items-center gap-5 shrink-0 border-2 border-neutral-50">
        <div id="container-blocos-dados" class="flex items-start gap-5 self-stretch">
            <div id="container-dados" class="flex p-5 flex-col items-center gap-4 flex[1_0_0] rounded-[20px] border-2 border-neutral-50 bg-neutral-800">
                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>

                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>

                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>
            </div>

            <div id="container-dados" class="flex p-5 flex-col items-center gap-4 flex[1_0_0] rounded-[20px] border-2 border-neutral-50 bg-neutral-800">
                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>

                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>

                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>
            </div>

            <div id="container-dados" class="flex p-5 flex-col items-center gap-4 flex[1_0_0] rounded-[20px] border-2 border-neutral-50 bg-neutral-800">
                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>

                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>

                <div id="container-texto" class="flex  p-[10px] justify-between items-start self-stretch border-b-2 border-neutral-700">
                    <span class="text-white font-inter text-2xl font-medium leading-normal">aaaaa</span>
                    <span class="text-white font-inter text-2xl font-medium leading-normal">99999</span>
                </div>



            </div>

        </div>

        
        </div>

    </div> -->
    <script>

        var socket = io();
        socket.on('connect', () => {
        console.log('Connected to WebSocket server');
        });

        document.addEventListener('htmx:load', function() {

      let width, height, gradient;
      function getGradient(ctx, chartArea) {
        const chartWidth = chartArea.right - chartArea.left;
        const chartHeight = chartArea.bottom - chartArea.top;
        if (!gradient || width !== chartWidth || height !== chartHeight) {
          // Create the gradient because this is either the first render
          // or the size of the chart has changed
          width = chartWidth;
          height = chartHeight;
          gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
          gradient.addColorStop(0, '#7C3AED00');
          // gradient.addColorStop(0.4, '#FFFF00');
          gradient.addColorStop(1, '#7C3AED');
        }

        return gradient;
      }
        const chartTensao = document.getElementById('chartTensao');
      //cleanup whats inside
      chartTensao.innerHTML = '';
      new Chart(chartTensao, {
        type: 'line',
        data: {
          labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
          datasets: [{
            data: [12, 19, 3, 5, 2, 3],
            borderWidth: 1,
            cubicInterpolationMode: 'monotone',
            fill:true,
            // backgroundColor:  '#AA00FF',
            backgroundColor:  function(context) {
              const chart = context.chart;
              const {ctx, chartArea} = chart;

              if (!chartArea) {
                // This case happens on initial chart load
                return;
              }
              return getGradient(ctx, chartArea);
            },
            // borderColor: '#AA00FF',
            borderColor: '#7C3AED'
          }]
        },
        options: {
          scales: {
            x: {
              ticks: {
                color: '#AAAAAA'
              },
              
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: '#AAAAAA'
              },
            }
          },
          plugins: {
            legend: {
              display: false, // Hide the legend
            }
          }
        },

      });
    </script>

  {% endblock %}